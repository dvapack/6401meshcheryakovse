# Конвейер обработки изображений кошек

![unemplyed_cat](image.png)

Проект реализует асинхронный конвейер для загрузки изображений кошек из TheCatAPI,
их обработки двумя разными реализациями и сохранения результатов по породам.
Конвейер разделен на три этапа: загрузка, обработка, сохранение.

## Возможности
- Получение списка изображений через TheCatAPI.
- Асинхронная загрузка изображений.
- Обработка в отдельном процессе:
  - собственная реализация детектирования границ (Sobel);
  - обработка через OpenCV (Canny).
- Сохранение оригинала и двух обработанных версий.
- Логирование в файл и консоль.

## Требования
- Python 3.11+
- Установленные зависимости из `requirements.txt`
- Ключ TheCatAPI в переменной окружения `API_KEY`

## Быстрый старт
1. Создайте виртуальное окружение и установите зависимости:
   ```bash
   python -m venv .venv
   source .venv/bin/activate
   pip install -r requirements.txt
   ```
2. Задайте ключ API:
   ```bash
   export API_KEY="ваш_ключ"
   ```
3. Запустите конвейер:
   ```bash
   python -m main
   ```

## Запуск в Docker
1. Создайте `.env`:
   ```bash
   API_KEY=ваш_ключ
   ```
2. Запустите:
   ```bash
   docker compose up --build
   ```

## Конфигурация
Все параметры настраиваются через переменные окружения:
- `API_KEY` - ключ доступа к TheCatAPI (обязателен).
- `API_BASE_URL` - адрес API (по умолчанию `https://api.thecatapi.com/v1/images/search`).
- `DOWNLOAD_WORKERS` - число воркеров загрузки (по умолчанию `3`).
- `PROCESSING_WORKERS` - число воркеров обработки (по умолчанию `2`).
- `SAVING_WORKERS` - число воркеров сохранения (по умолчанию `2`).
- `DOWNLOAD_QUEUE_SIZE` - размер очереди загрузки (по умолчанию `10`).
- `PROCESSING_QUEUE_SIZE` - размер очереди обработки (по умолчанию `10`).
- `SAVING_QUEUE_SIZE` - размер очереди сохранения (по умолчанию `5`).
- `MAX_IMAGES` - количество изображений за запуск (по умолчанию `10`).
- `OUTPUT_DIR` - каталог для результатов (по умолчанию `processed_cats`).
- `LOG_DIR` - каталог для логов (по умолчанию `logs`).
- `API_TIMEOUT` - таймаут запросов к API в секундах (по умолчанию `30.0`).

## Структура результатов
Файлы сохраняются по породам и запуску:
```
processed_cats/
  <breed>/
    <run_id>/
      <index>_<breed>_original.png
      <index>_<breed>_custom.jpg
      <index>_<breed>_cv2.jpg
```

## Логи
Логи пишутся в `logs` и дублируются в консоль. Имя файла содержит дату запуска:
`cat_pipeline_YYYYMMDD.log`.

## Структура проекта
- `main.py` - точка входа.
- `src/api/cat_api_client.py` - клиент TheCatAPI.
- `src/pipeline/pipeline.py` - оркестратор конвейера.
- `src/pipeline/workers/` - воркеры загрузки, обработки и сохранения.
- `src/image_processing/` - интерфейсы и реализации обработки.
- `src/models/models.py` - структуры данных.
- `src/config/` - конфигурация и логирование.
- `tests/` - тесты.

## Примеры работы

### Изображение до обработки

![macktraher](image.jpg)

### Изображение после обработки

![processed_macktraher](image_processed.jpg)
